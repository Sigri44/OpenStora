<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" /><title>Root Access Via TFTP - OpenStora</title>
<meta name="generator" content="MediaWiki 1.22.6" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="https://sigri44.github.io/OpenStora/wiki/opensearch_desc.php" title="OpenStora (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://sigri44.github.io/OpenStora/wiki/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="OpenStora Atom feed" href="https://sigri44.github.io/OpenStora/wiki/index_Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="style.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: hardwar6_wiki:resourceloader:filter:minify-css:7:a5305c32ce5719fffdb0ebb117d3d93a */</style>

<script src="https://sigri44.github.io/OpenStora/wiki/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Root_Access_Via_TFTP","wgTitle":"Root Access Via TFTP","wgCurRevisionId":836,"wgRevisionId":836,"wgArticleId":6,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Root_Access_Via_TFTP","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"vector-simplesearch":1,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,
"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"useeditwarning":1,"prefershttps":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: hardwar6_wiki:resourceloader:filter:minify-js:7:5a69c7e0fa6557851b6dea8a62efaffb */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("https://sigri44.github.io/OpenStora/wiki/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Root_Access_Via_TFTP skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Root Access Via TFTP</span></h1>
			<div id="bodyContent">
								<div id="siteSub">From OpenStora</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#YOU_ALMOST_CERTAINLY_DO_NOT_WANT_TO_DO_THIS"><span class="tocnumber">1</span> <span class="toctext"><b>YOU ALMOST CERTAINLY DO NOT WANT TO DO THIS</b></span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#How_to_gain_root_access_on_your_Netgear_Stora"><span class="tocnumber">2</span> <span class="toctext">How to gain root access on your Netgear Stora</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Required_Items"><span class="tocnumber">3</span> <span class="toctext">Required Items</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Installing_Support_Software"><span class="tocnumber">4</span> <span class="toctext">Installing Support Software</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Obtain_Alternate_File_system_and_Kernel"><span class="tocnumber">5</span> <span class="toctext">Obtain Alternate File system and Kernel</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Starting_the_Magic"><span class="tocnumber">6</span> <span class="toctext">Starting the Magic</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Disclaimers"><span class="tocnumber">7</span> <span class="toctext">Disclaimers</span></a></li>
</ul>
</div>

<h3><span class="mw-headline" id="YOU_ALMOST_CERTAINLY_DO_NOT_WANT_TO_DO_THIS"><b>YOU ALMOST CERTAINLY DO NOT WANT TO DO THIS</b></span></h3>
<p><b>See <a href="https://sigri44.github.io/OpenStora/wiki/index_Easy_Root_Access" title="Easy Root Access">Easy Root Access</a> for a much saner way to gain root access.</b> You only really need to use this TFTP method to gain root access if you have previously gained root control and then locked yourself out of the system by, for example, corrupting the /etc/sudoers file. (Stop laughing at the back.)
</p>
<h2><span class="mw-headline" id="How_to_gain_root_access_on_your_Netgear_Stora">How to gain root access on your Netgear Stora</span></h2>
<p>Author: Bryan McGuire 
<br />Edited by: Nathan Willard, Dustin Essington
</p><p>The Netgear Stora, out of the box, runs an ssh server.  
The password, however, is disabled.  The only way to log into the Stora is as root, and there is absolutely no password you can enter for root that will work.   
</p><p>What you will do in this hack is add a public key for ssh onto your stora, and get a root shell without needing a password.
</p>
<h2><span class="mw-headline" id="Required_Items">Required Items</span></h2>
<ul>
<li>A pc running linux (redhat, debian, gentoo, ubuntu, doesn't matter) with an unused ethernet interface. (OS X will have issues with the NFS export/tar archive. It can't be used.) Edit: aetaric (not needed: with an unused ethernet interface) Edit: yopnono
</li>
<li>A Netgear Stora
</li>
<li>A Ethernet switch preferably:a gigabit Ethernet switch -- NFS root filesystems suck hard, and are barely usable with anything less. (but it works) Edit: yopnono
</li>
<li>A couple of ethernet cables to hook the above three items together. 
</li>
</ul>
<p>Alternatively you could use:
</p>
<ul>
<li>Crossover cables (you don't even need a crossover cable, Stora is autosensing so a regular cable can be used to hook-up the Stora directly to the laptop with Gigabit connection!) Edit: pippone
</li>
</ul>
<h2><span class="mw-headline" id="Installing_Support_Software">Installing Support Software</span></h2>
<p>You now have to install the required software on your linux machine, if you haven't already.  Using apt-get, emerge, yum, or whatever, install the following:
</p>
<ul>
<li>nfs server (for me, it's called "nfs-kernel-server" )
</li>
<li>tftpd
</li>
<li>wireshark (formerly called ethereal -- if you know how to use snort you can use that instead.
</li>
</ul>
<p>Set up your ethernet interface with the ip of 10.0.0.1 and a netmask of 255.0.0.0, its default route (gateway) needs to be the interface address itself, 10.0.0.1
</p><p>turn on ip masquerading: (not needed) Edit: yopnono
</p>
<pre>
echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward
echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_dynaddr
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
</pre>
<p><b>Note:</b> eth0 is interface used for your linux box's internet connection, and not eth1, which is used by the 10.x.x.x network for the Stora)
</p>
<h2><span class="mw-headline" id="Obtain_Alternate_File_system_and_Kernel">Obtain Alternate File system and Kernel</span></h2>
<p>If you haven't yet downloaded the files you'll need, do so from <a rel="nofollow" class="external text" href="https://sigri44.github.io/OpenStora/files/albums/uploads/alternates_tar.bz2">here</a>.
</p><p>Make sure you don't have anything under /mnt cause extracting the archive will eventually overwrite that directory
</p><p>Make sure you are root
</p><p>Move the alternates.tar.bz2 from wherever you downloaded it to the root directory of your linux machine:
</p>
<pre>
&gt; mv alternates.tar.bz2 /alternates.tar.bz2
</pre>
<p>Extract these files on to your Linux machine:
</p>
<pre>
&gt; cd /
&gt; tar xvjf alternates.tar.bz2
</pre>
<p>configure your nfs server by adding the following in the <i>/etc/exports</i> file:
</p>
<pre>
/mnt/Axentra/marvell.nfs.rootfs/ 10.0.0.0/8(rw,no_root_squash,sync,no_subtree_check)
</pre>
<p>rehash the nfs-server:
</p>
<pre>
&gt; service nfs-kernel-server restart
</pre>
<p>in <i>/etc/inetd.conf</i>, enable your tftpd server by adding the following line:
</p>
<pre>
tftp        dgram    udp    wait    nobody    /usr/sbin/tcpd    /usr/sbin/in.tftpd /tftpboot
</pre>
<p>rehash the intetd daemon:
</p>
<pre>
&gt; killall -HUP inetd
</pre>
<p><b>Note:</b> some linux distros (ubuntu 9.10) don't use inetd anymore, they're using xinetd, you have three options: configure tftpd with xinetd, replace xinetd with inetd or install a daemon version of tftpd. Here's how to install the daemon version "tftpd-hpa" (recommended for Ubuntu 9.10):
</p>
<pre>
apt-get install tftpd-hpa
</pre>
<p>Change this file and set the following options:
</p>
<pre>
vi /etc/default/tftpd-hpa

#Defaults for tftpd-hpa

RUN_DAEMON=&quot;yes&quot;

OPTIONS=&quot;-l -s /tftpboot&quot;
</pre>
<p>Restart the daemon
</p>
<pre>
sudo /etc/init.d/tftpd-hpa restart
</pre>
<p><b>Note:</b> tftpd-hpa seems to be a bit on the buggy side and if you get an 'Error1: File not found error' then it's highly likely that the daemon has ignored your preference for the root directory and is looking its default directory which is /var/lib/tftpboot. Putting the uImage file in there will likely solve your problem.
</p>
<h2><span class="mw-headline" id="Starting_the_Magic">Starting the Magic</span></h2>
<p>Start up wireshark (you may have to be root to do this) and start listening to eth1
</p><p>While holding down the small reset button on the stora with a paper clip (or equivalent instrument), turn on the stora. You'll need to hold in the reset button for quite some time.
</p><p>The lights on the front panel will go through three cycles. Eventually, you will see the tftp transfer in wireshark, and at this point you can release the reset button.
</p><p>After the tftp transfer, there will be a couple of arp requests, and then you should see the nfs activity. Your linux drive will start working like crazy as your Stora boots with the nfs mounted alternate filesystem.
</p><p>Once the Stora is booted, you will be able to log into it.  
</p><p>The ip address you need to use will be in wireshark, It's the <i>10.x.x.x</i> address that's not 10.0.0.1.
</p>
<pre>ssh root@10.x.x.x </pre>
<p><b>Note:</b> <i>x</i> denotes the ip of the Stora found in wireshark.
</p><p>The password will be <i>root</i>
</p><p>Mount the Stora's regular root filesystem, by running the following commands while logged into the Stora:
</p>
<pre>
mkdir -p /mnt/ubifs
cd /lib/modules/2.6.22.18-Netgear
modprobe ubi mtd=2,2048
modprobe ubifs
mount -t ubifs ubi0:rootfs /mnt/ubifs
</pre>
<p>The Stora's regular file system is now mounted on <i>/mnt/ubifs</i>
</p><p>Add your public ssh key into <i>/mnt/ubifs/root/.ssh/authorized_keys</i> and type
</p>
<pre>
shutdown -h now
</pre>
<p>the stora will then shutdown and turn itself off.
</p><p>Now you can move the Stora back to your regular network and ssh into it as root using your private ssh key.
</p>
<h2><span class="mw-headline" id="Disclaimers">Disclaimers</span></h2>
<p>I did all this using ubuntu 9.10 running on a Mac Pro, and the config lines for nfs, tftpd, and such are what work on my machine with my Stora.  You might have to use something else for your particular distro and/or particular unit.  I'm detailing what finally worked for me. This might not work for you.  You may end up bricking your Stora, and if you do, don't blame me. I don't work for Netgear, HipServ, or anyone related to the sale, development, or distribution of this device. I'm just someone who bought one at Best Buy, loved the hardware, but was thoroughly unhappy with its firmware.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.031 seconds
Real time usage: 0.039 seconds
Preprocessor visited node count: 143/1000000
Preprocessor generated node count: 292/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key hardwar6_wiki:pcache:idhash:6-0!*!0!!en!*!* and timestamp 20171202190731
 -->
</div>								<div class="printfooter">
				Retrieved from "<a href=/wiki/index_Root_Access_Via_TFTP&amp;oldid=836">/wiki/index_Root_Access_Via_TFTP&amp;oldid=836</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-login"><a href="https://sigri44.github.io/OpenStora/wiki/index_Special:UserLogin&amp;returnto=Root+Access+Via+TFTP" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="https://sigri44.github.io/OpenStora/wiki/index_Root_Access_Via_TFTP"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="https://sigri44.github.io/OpenStora/wiki/index_Talk:Root_Access_Via_TFTP&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view" class="selected"><span><a href="https://sigri44.github.io/OpenStora/wiki/index_Root_Access_Via_TFTP" >Read</a></span></li>
					<li id="ca-viewsource"><span><a href="https://sigri44.github.io/OpenStora/wiki/index_Root_Access_Via_TFTP&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="https://sigri44.github.io/OpenStora/wiki/index_Root_Access_Via_TFTP&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="https://sigri44.github.io/OpenStora/wiki/index.php" id="searchform">
				<div id="simpleSearch">
						<input name="search" placeholder="Search" title="Search OpenStora [f]" accesskey="f" id="searchInput" />						<button type="submit" name="button" title="Search the pages for this text" id="searchButton"><img src="https://sigri44.github.io/OpenStora/wiki/skins/vector/images/search-ltr.png?303" alt="Search" width="12" height="13" /></button>								<input type='hidden' name="title" value="Special:Search"/>
		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(/wiki/images/logo.png);" href="https://sigri44.github.io/OpenStora/wiki/index_Main_Page"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-Website' aria-labelledby='p-Website-label'>
	<h3 id='p-Website-label'>Website</h3>
	<div class="body">
		<ul>
			<li id="n-OpenStora-Home"><a href="https://sigri44.github.io/OpenStora/" rel="nofollow">OpenStora Home</a></li>
			<li id="n-OpenStora-Forum"><a href="https://sigri44.github.io/OpenStora/phpBB3" rel="nofollow">OpenStora Forum</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Wiki' aria-labelledby='p-Wiki-label'>
	<h3 id='p-Wiki-label'>Wiki</h3>
	<div class="body">
		<ul>
			<li id="n-Main-Page"><a href="https://sigri44.github.io/OpenStora/wiki/index_Main_Page">Main Page</a></li>
			<li id="n-Recent-changes"><a href=/wiki/index_Special:Recentchanges" rel="nofollow">Recent changes</a></li>
			<li id="n-Help"><a href="https://sigri44.github.io/OpenStora/wiki/index_Help">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="https://sigri44.github.io/OpenStora/wiki/index_Special:WhatLinksHere/Root_Access_Via_TFTP" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="https://sigri44.github.io/OpenStora/wiki/index_Special:RecentChangesLinked/Root_Access_Via_TFTP" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="https://sigri44.github.io/OpenStora/wiki/index_Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-print"><a href="https://sigri44.github.io/OpenStora/wiki/index_Root_Access_Via_TFTP&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
			<li id="t-permalink"><a href="https://sigri44.github.io/OpenStora/wiki/index_Root_Access_Via_TFTP&amp;oldid=836" title="Permanent link to this revision of the page">Permanent link</a></li>
			<li id="t-info"><a href="https://sigri44.github.io/OpenStora/wiki/index_Root_Access_Via_TFTP&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 8 September 2011, at 16:02.</li>
											<li id="footer-info-viewcount">This page has been accessed 32,185 times.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="https://sigri44.github.io/OpenStora/wiki/index_OpenStora:Privacy_policy" title="OpenStora:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="https://sigri44.github.io/OpenStora/wiki/index_OpenStora:About" title="OpenStora:About">About OpenStora</a></li>
											<li id="footer-places-disclaimer"><a href="https://sigri44.github.io/OpenStora/wiki/index_OpenStora:General_disclaimer" title="OpenStora:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="//www.mediawiki.org/"><img src="https://sigri44.github.io/OpenStora/wiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<!-- Served in 0.188 secs. -->
	</body>
</html>
